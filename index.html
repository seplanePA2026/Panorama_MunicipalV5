<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panorama Municipal ‚Ä¢ Paulo Afonso</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="assets/js/vendor/xlsx-fallback.js"></script>
  <link rel="stylesheet" href="assets/css/app.css" />

  <!-- Escala padr√£o da interface (equivale a "zoom" 90% no app; n√£o altera o zoom do navegador) -->
  <style id="pmDefaultScale">
    :root{ --pm-ui-scale: .9; }
    /* Preferencial (Chromium/Edge): */
    html{ zoom: var(--pm-ui-scale); }
    /* Fallback (ex.: Firefox): */
    @supports not (zoom: 1){
      html, body{ height: 100%; }
      body{
        transform: scale(var(--pm-ui-scale));
        transform-origin: top left;
        width: calc(100% / var(--pm-ui-scale));
        height: calc(100% / var(--pm-ui-scale));
      }
    }
  </style>

  <script>
    (function(){
      try{
        if(sessionStorage.getItem('pm_auth') === '1'){
          document.documentElement.classList.add('auth-ok');
        }
      }catch(_e){}
    })();
  </script>
</head>

<body>
  <div class="loginScreen" id="loginScreen" aria-label="Login">
    <div class="loginCard">
      <img class="loginLogo" src="assets/img/login-paulo-afonso.png" alt="Prefeitura de Paulo Afonso" />
      <div class="loginTitle">Panorama Municipal</div>

      <div class="loginForm" role="form" aria-label="Formul√°rio de login">
        <div class="field">
          <label for="loginUser">Usu√°rio</label>
          <input id="loginUser" class="textInput" type="text" autocomplete="username" placeholder="admin" />
        </div>
        <div class="field">
          <label for="loginPass">Senha</label>
          <input id="loginPass" class="textInput" type="password" autocomplete="current-password" placeholder="admin" />
        </div>

        <div class="loginError" id="loginError" aria-live="polite"></div>

        <button class="btn primary loginBtn" id="btnLogin" type="button">Entrar</button>
      </div>
    </div>
  </div>

  <div id="appShell">
  <div class="topbar">
    <div class="brand">
      <div class="logo">
        <img class="brandLogo" src="assets/img/brasao-paulo-afonso.png" alt="" />
      </div>
      <div class="ttl">
        <b>Panorama Municipal</b>
        <span>Paulo Afonso</span>
      </div>
    </div>

    <div class="top-actions">
      <button class="iconBtn" id="btnLoadOnline" title="Atualizar base online" aria-label="Atualizar base online">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 0 1-15.3 6.4"/><path d="M3 12a9 9 0 0 1 15.3-6.4"/><path d="M3 3v6h6"/><path d="M21 21v-6h-6"/></svg>
      </button>
      <button class="iconBtn" id="btnSettings" title="Configura√ß√µes" aria-label="Configura√ß√µes">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.9 7.9 0 0 0 .1-1 7.9 7.9 0 0 0-.1-1l2-1.5-2-3.5-2.3 1a8 8 0 0 0-1.7-1l-.3-2.5h-4l-.3 2.5a8 8 0 0 0-1.7 1l-2.3-1-2 3.5 2 1.5a7.9 7.9 0 0 0-.1 1 7.9 7.9 0 0 0 .1 1l-2 1.5 2 3.5 2.3-1a8 8 0 0 0 1.7 1l.3 2.5h4l.3-2.5a8 8 0 0 0 1.7-1l2.3 1 2-3.5-2-1.5Z"/></svg>
      </button>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      
      <div class="leftShell">
        <div class="sideNav" id="sideNav">
          <div class="navList" id="navList" aria-label="Categorias">
            <div class="navBtn" data-group="mapa" title="Mapa"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6.5l6-2.5 6 2.5 6-2.5v14l-6 2.5-6-2.5-6 2.5v-14Z"/><path d="M9 4v14"/><path d="M15 6.5v14"/></svg></div>
            <div class="navBtn active" data-group="territorio" title="Territ√≥rio"><svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15 15 0 0 1 0 20"/><path d="M12 2a15 15 0 0 0 0 20"/></svg></div>
            <div class="navBtn" data-group="economia" title="Economia"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 7h8"/><path d="M8 11h8"/><path d="M8 15h5"/><rect x="5" y="4" width="14" height="17" rx="2"/></svg></div>
            <div class="navBtn" data-group="populacao" title="Popula√ß√£o"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16 11a4 4 0 1 0-8 0"/><path d="M6 20a6 6 0 0 1 12 0"/><path d="M19 20a4.5 4.5 0 0 0-4-4.4"/><path d="M18 7.5a3 3 0 1 1-3 3"/></svg></div>
            <div class="navBtn" data-group="educacao" title="Educa√ß√£o"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 10L12 5 2 10l10 5 10-5Z"/><path d="M6 12v5c0 1.7 2.7 3 6 3s6-1.3 6-3v-5"/></svg></div>
            <div class="navBtn" data-group="secad" title="SECAD"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 4h10v3"/><rect x="4" y="7" width="16" height="14" rx="2"/><path d="M8 11h8"/><path d="M8 15h8"/></svg></div>
            <div class="navBtn" data-group="eleitoral" title="Eleitoral"><svg viewBox="0 0 24 24" aria-hidden="true"><rect x="5" y="3" width="14" height="18" rx="2"/><path d="M9 12l2 2 4-4"/><path d="M8 21h8"/></svg></div>
            <div class="navBtn" data-group="agua_esgoto" title="√Ågua e Esgoto"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2s6 7 6 12a6 6 0 0 1-12 0C6 9 12 2 12 2Z"/><path d="M7 20c1.5-1 3-1.5 5-1.5S15.5 19 17 20"/></svg></div>
            <div class="navBtn" data-group="atlas_vulnerabilidade" title="Atlas Vulnerabilidade"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l8 4v6c0 5-3.4 9.4-8 10-4.6-.6-8-5-8-10V6l8-4Z"/><path d="M9 12l2 2 4-4"/></svg></div>
          </div>
          <div class="navMini" id="baseBadge">Base<br>‚Äî</div>
        </div>

        <div class="drawer" id="drawer">
          <div class="drawerInner">
            <div class="drawerTop">
              <h3 id="drawerTopTitle">‚Äî</h3>
              <div style="display:flex; gap:10px; align-items:center;">
                <span class="pill" id="leftCount">0 abas</span>
                <button class="closeX" id="btnCloseDrawer" title="Fechar">‚úï</button>
              </div>
            </div>
            <div class="drawerBody">
              <div class="section-title" id="drawerTitle">Categorias</div>
              <div class="tabScroll" style="flex:1;">
                <div class="tablist" id="mainTabs">
                  <div class="empty">Nenhuma planilha carregada.</div>
                </div>
              </div>
              <div class="muted" style="font-size:11px; font-weight:800;">
                Clique em um √≠cone √† esquerda para abrir/filtrar as categorias.
              </div>
            </div>
          </div>
        </div>
      </div>

      


<div class="projBar projTop" id="projBar" style="display:none;">
  <div class="projLeft">
    <span class="projChip" aria-label="Proje√ß√µes">
      <svg class="projIco" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 19V5"></path>
        <path d="M4 19h16"></path>
        <path d="M7 14l3-3 3 2 5-6"></path>
      </svg>
      <span class="projChipTitle">Proje√ß√µes</span>
      <span class="projVal" id="projVal">‚Äî</span>
      <span class="projTrend" id="projTrend">‚Äî</span>
    </span>
    <span class="projLbl" id="projLbl">‚Äî</span>
  </div>

</div>

      <div class="card indiceCard" id="indiceCard" style="display:none;">
        <div class="card-h">
          <h3 id="indiceTitle">√çndice</h3>
          <span class="pill" id="indiceMeta">‚Äî</span>
        </div>
        <div class="indiceBody">
          <iframe class="indiceFrame" id="indiceFrame" title="√çndice" src="about:blank"></iframe>
        </div>
      </div>

      <div class="card mapCard">
        <div class="card-h">
          <div class="cardTitleRow">
            <h3>Mapa</h3>
</div>

          
          <div class="subtabs" id="subTabs">
            <span class="pill">Selecione uma aba</span>
          </div>
</div>

        <div class="centerBody" id="centerBody">
          <div class="mapRegion">
            <div class="mapTools">
              <button class="toolBtn" id="btnToggleMap" title="Compactar mapa" aria-label="Compactar mapa"></button>
            </div>
            <iframe class="mapFrame" id="mapFrame" title="Mapa" src="about:blank"></iframe>

            <div class="mapSidePanel" id="mapSidePanel">
              <div class="mapSideHead">
                <b id="pieTitle">Explica√ß√£o</b>
                <span id="pieSub">‚Äî</span>
              </div>

              <div class="expWrap" id="expWrap">
                <div class="pieEmpty" id="pieEmpty" style="display:none">Selecione uma categoria, um ano e um indicador para ver a explica√ß√£o.</div>
                <div class="expContent" id="expContent"></div>
              </div>
            </div>

            <div class="mapOverlay">
              <div class="miniCard" id="mapInfo">
                <b>Sele√ß√£o no mapa</b>
                <span>Clique em um setor/fei√ß√£o para ver detalhes.</span>
              </div>

              <div class="miniRight">
                <button class="btn secondary" id="btnClearMap" style="pointer-events:auto;">Limpar</button>
              </div>
            </div>
          </div>

          
          <div class="compareRegion">
            <div class="chartCard" style="width:100%; flex:1; min-height:0;">
              <div class="chartHead">
                <b>Comparativo ‚Ä¢ 5 cidades (BA)</b>
                <span class="tag" id="compareTag">üü† Comparativo na mesma planilha</span>
              </div>
              <div style="padding:0 10px 10px;">
                <div class="legend">
                  <span><span class="dot blue"></span>Paulo Afonso</span>
                  <span><span class="dot orange"></span>Outras cidades</span>
                </div>
              </div>
              <div class="chartBody" id="compareChart">
                <div class="empty">
                  Adicione linhas de <b>outros munic√≠pios</b> na mesma aba (ex.: IDHM) para habilitar o comparativo.
                </div>
              </div>
            </div>
            <div class="muted" style="font-size:11px; font-weight:800;">
              Dica: o comparativo usa o mesmo indicador/subaba e ano selecionado.
            </div>
          </div>
        </div>
      </div>

      
      <div class="card rightCard">
        <div class="card-h">
          <h3 id="rightTitle">Dados</h3>
          <span class="pill" id="rightMeta">‚Äî</span>
        </div>

        <div class="right">

          <div class="rightMode" id="rightDataMode">
            <div class="panelBox">
              <div class="panelHead">
                <b>Indicadores</b>
                <span id="indicatorHint">Clique em um indicador para atualizar o gr√°fico</span>
              </div>
              <div class="panelBody" id="dataPanel">
                <div class="empty">Carregue a planilha e selecione uma categoria.</div>
              </div>
            </div>

            <div class="chartCard">
              <div class="chartHead">
                <b id="trendTitle">Compara√ß√£o por ano</b>
                <span class="tag" id="trendTag">‚Äî</span>
              </div>
                <div style="padding:0 10px 10px;">
                  <div class="legend" id="trendLegend"></div>
                </div>
              <div class="chartBody" id="trendChart">
                <div class="empty">Selecione uma categoria e um indicador.</div>
              </div>
            </div>
          </div>

          <div class="rightMode" id="rightMapMode" style="display:none;">
            <div class="panelBox" style="flex:1; display:flex; flex-direction:column; min-height:0;">
              <div class="panelHead">
                <b>Configura√ß√µes do mapa</b>
                <span id="mapCfgMeta">Camadas ‚Ä¢ marque para exibir</span>
              </div>
              <div class="panelBody" id="mapConfigPanel">
                <div class="empty">Carregando camadas do mapa‚Ä¶</div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>

  
  <div class="timeline">
    <div class="inner">
      <div class="label">Timeline</div>
      <div class="yearStrip" id="yearsStrip">
        <span class="muted">‚Äî</span>
      </div>
    </div>
  </div>

  <div id="chartTooltip" class="chartTooltip" aria-hidden="true"></div>

  <div class="settingsOverlay" id="settingsOverlay" style="display:none;" aria-hidden="true">
    <div class="settingsPanel" role="dialog" aria-modal="true" aria-label="Configura√ß√µes">
      <div class="settingsTop">
        <div class="settingsTitle">
          <h2>Configura√ß√µes</h2>
          <span class="muted">Ajustes e personaliza√ß√£o do painel</span>
        </div>
        <button class="closeX" id="btnCloseSettings" title="Fechar" aria-label="Fechar">‚úï</button>
      </div>

      <div class="settingsBody">

        <div class="settingsCard">
          <div class="settingsCardHead">
            <b>Mapa base</b>
            <span class="muted">Exiba/oculte o fundo (OSM Standard).</span>
          </div>

          <div class="settingsRow">
            <label class="switch">
              <input type="checkbox" id="toggleBaseMap" checked />
              <span class="slider" aria-hidden="true"></span>
            </label>
            <div class="switchTxt">
              <b>Exibir mapa (OSM)</b>
              <span class="muted">Desative para deixar o fundo em branco.</span>
            </div>
          </div>
        </div>

        <div class="settingsCard">
          <div class="settingsCardHead">
            <b>Categorias do mapa</b>
            <span class="muted">Crie e organize categorias de camadas/op√ß√µes do mapa. S√≥ √© poss√≠vel editar aqui.</span>
          </div>

          <div class="settingsRow">
            <button class="btn primary" id="btnAddMapCategory">Ôºã Adicionar categoria do mapa</button>
          </div>

          <div class="catForm" id="mapCatForm" style="display:none;">
            <div class="field">
              <label for="mapCatName">Nome da categoria</label>
              <input id="mapCatName" class="textInput" type="text" placeholder="Ex.: Sa√∫de" autocomplete="off" />
            </div>

            <div class="field">
              <label>√çcone (imagem)</label>
              <div class="iconPickRow">
                <button class="btn secondary" id="btnPickMapCatIcon" type="button">Escolher imagem</button>
                <span class="muted" id="mapCatIconName">Nenhuma imagem</span>
                <input type="file" id="mapCatIconFile" accept="image/*" hidden />
              </div>
              <div class="catIconPreview" id="mapCatIconPreview" style="display:none;"></div>
            </div>

            <div class="field">
              <label>Op√ß√µes (Todos)</label>
              <input id="mapOptSearch" class="textInput" type="text" placeholder="Pesquisar op√ß√£o do mapa‚Ä¶" autocomplete="off" />
              <div class="mapOptPickList" id="mapOptPickList">
                <div class="muted" style="font-weight:850;">Carregando op√ß√µes do mapa‚Ä¶</div>
              </div>
              <div class="muted" style="font-size:11px; font-weight:850; margin-top:8px;">
                A categoria <b>Todos</b> √© autom√°tica e sempre inclui todas as op√ß√µes do mapa.
              </div>
            </div>

            <div class="formActions">
              <button class="btn primary" id="btnSaveMapCategory" type="button">Salvar</button>
              <button class="btn secondary" id="btnCancelMapCategory" type="button">Cancelar</button>
            </div>
          </div>

          <div class="catList" id="mapCatList"></div>
        </div>

        <div class="settingsCard">
          <div class="settingsCardHead">
            <b>Adicionar nova categoria</b>
            <span class="muted">Crie um novo bot√£o no menu lateral e conecte com a categoria da planilha.</span>
          </div>

          <div class="settingsRow">
            <button class="btn primary" id="btnAddCategory">Ôºã Adicionar nova categoria</button>
          </div>

          <div class="catForm" id="catForm" style="display:none;">
            <div class="field">
              <label for="catName">Nome da categoria</label>
              <input id="catName" class="textInput" type="text" placeholder="Ex.: Infraestrutura" autocomplete="off" />
            </div>

            <div class="field">
              <label>√çcone (imagem)</label>
              <div class="iconPickRow">
                <button class="btn secondary" id="btnPickCatIcon" type="button">Escolher imagem</button>
                <span class="muted" id="catIconName">Nenhuma imagem</span>
                <input type="file" id="catIconFile" accept="image/*" hidden />
              </div>
              <div class="catIconPreview" id="catIconPreview" style="display:none;"></div>
            </div>

            <div class="formActions">
              <button class="btn primary" id="btnSaveCategory" type="button">Salvar</button>
              <button class="btn secondary" id="btnCancelCategory" type="button">Cancelar</button>
            </div>
          </div>

          <div class="catList" id="catList"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="assets/js/main.js"></script>
  </div>
</body>
</html>
